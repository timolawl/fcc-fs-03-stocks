!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n||e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){"use strict";function createChart(seriesOptions){Highcharts.stockChart(document.querySelector(".chart"),{rangeSelector:{selected:4},yAxis:{labels:{formatter:function(){return(this.value>0?" + ":"")+this.value+"%"}},plotLines:[{value:0,width:2,color:"silver"}]},plotOptions:{series:{compare:"percent",showInNavigator:!0}},tooltip:{pointFormat:'<span style="color:{series.color}">{series.name}</span>: <b>{point.y}</b> ({point.change}%)<br/>',valueDecimals:2,split:!0},series:seriesOptions})}function checkLastUpdate(date){var sameDate=!1,lastUpdated=new Date(date),now=new Date;return lastUpdated.getUTCDate()===now.getUTCDate()&&lastUpdated.getUTCMonth()===now.getUTCMonth()&&lastUpdated.getUTCFullYear()===now.getUTCFullYear()&&(sameDate=!0),sameDate}function generateStockUIElement(stockName,companyName,index){var fragment=document.createDocumentFragment(),highchartColors=Highcharts.getOptions().colors,stockWrapper=document.createElement("div");if(stockWrapper.className="wrapper--stock medium-6 large-6 columns",index%2==0){var newRow=document.createElement("div");newRow.classList.add("row"),newRow.classList.add("row-"+index),fragment.appendChild(newRow),newRow.appendChild(stockWrapper)}else fragment.appendChild(stockWrapper);var stock=document.createElement("div");stock.className="stock",stock.style.border="1px solid "+highchartColors[index],stock.setAttribute("data-border-color",highchartColors[index]),stockWrapper.appendChild(stock);var ticker=document.createElement("div");ticker.classList.add("stock__ticker"),ticker.textContent=stockName,stock.appendChild(ticker);var company=document.createElement("div");company.classList.add("stock__company-name"),company.textContent=companyName,stock.appendChild(company);var remove=document.createElement("button");remove.className="hollow button alert stock__remove",remove.setAttribute("type","button"),stock.appendChild(remove);var srClose=document.createElement("span");srClose.classList.add("show-for-sr"),srClose.textContent="Close",remove.appendChild(srClose);var close=document.createElement("span");close.classList.add("stock__remove--icon"),close.setAttribute("aria-hidden","true"),close.innerHTML="&times;",remove.appendChild(close),remove.addEventListener("click",function(e){socket.emit("remove ticker",{ticker:stockName}),e.target.parentNode.parentNode.removeChild(e.target.parentNode)}),index%2==0?document.querySelector(".stocks").appendChild(fragment):document.querySelector(".stocks").lastChild.appendChild(fragment)}var socket=io();window.onload=function(){socket.on("no tickers",function(){document.querySelector(".chart-loader").classList.add("display--hide")}),socket.on("error message",function(data){data.display?document.querySelector(".error-message").classList.remove("visibility--hide"):document.querySelector(".error-message").classList.add("visibility--hide")}),socket.emit("request tickers",{}),document.querySelector(".chart-loader").classList.remove("display--hide"),socket.on("update processed",function(data){socket.emit("request tickers",{})}),document.querySelector(".stock--add").addEventListener("submit",function(e){e.preventDefault();var inputAdd=document.querySelector(".form__input--add").value;inputAdd&&/^[A-Za-z][A-Za-z\.:]{0,9}$/.test(inputAdd)?(socket.emit("add ticker",{ticker:document.querySelector(".form__input--add").value.toUpperCase()}),document.querySelector(".form__input--add").value=""):document.querySelector(".error-message").classList.remove("visibility--hide")}),document.querySelector(".stock--remove").addEventListener("submit",function(e){e.preventDefault();var inputRemove=document.querySelector(".form__input--remove").value;inputRemove&&/^[A-Za-z][A-Za-z\.:]{0,9}$/.test(inputRemove)?(socket.emit("remove ticker",{ticker:document.querySelector(".form__input--remove").value.toUpperCase()}),document.querySelector(".form__input--remove").value=""):document.querySelector(".error-message").classList.remove("visibility--hide")}),socket.on("repaint",function(data){for(var stocksNode=document.querySelector(".stocks");stocksNode.firstChild;)stocksNode.removeChild(stocksNode.firstChild);var seriesOptions=[],seriesCounter=0,names=data.stockTickers,promises=names.map(function(name,index){if(!sessionStorage.getItem(name)||!checkLastUpdate(JSON.parse(sessionStorage.getItem(name)).lastUpdated)){var companyName="",today=new Date,sessionData=void 0,days=void 0,to=new Date,from=new Date(to);from.setMonth(to.getMonth()-12);var month=from.getUTCMonth()+1;month<10&&(month="0"+month);var urlFromSegment=from.getUTCFullYear()+"-"+month+"-"+(from.getUTCDate()-2),urlToSegment=to.getUTCFullYear()+"-"+month+"-"+(to.getUTCDate()-2),URL="https://www.quandl.com/api/v3/datasets/WIKI/"+name+".json?api_key=hnTnwtHfNGzsTTSxAFZ4&start_date="+urlFromSegment+"&end_date="+urlToSegment;return fetch(URL).then(function(res){return res.json()}).then(function(json){var re=/^(.*?)\(/;companyName=json.dataset.name.match(re)[1],days=json.dataset.data.map(function(data){return[Date.parse(data[0]),data[4]]}).sort()}).then(function(){sessionData={stock:name,company:companyName,data:days,lastUpdated:today},sessionStorage.setItem(name,JSON.stringify(sessionData)),seriesOptions[index]={name:name,data:days},(seriesCounter+=1)===names.length&&(document.querySelector(".chart-loader").classList.add("display--hide"),createChart(seriesOptions))})}var sessionStoredStock=JSON.parse(sessionStorage.getItem(name));seriesOptions[index]={name:name,data:sessionStoredStock.data},(seriesCounter+=1)===names.length&&(document.querySelector(".chart-loader").classList.add("display--hide"),createChart(seriesOptions))});Promise.all(promises).then(function(){for(var i=0;i<names.length;i++){var company=JSON.parse(sessionStorage.getItem(names[i]));generateStockUIElement(names[i],company.company,i)}})})}},{}]},{},[1]);
//# sourceMappingURL=post.bundle.js.map

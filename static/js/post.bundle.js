!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){"use strict";function createChart(seriesOptions){Highcharts.stockChart("chart",{rangeSelector:{selected:4},yAxis:{labels:{formatter:function(){return(this.value>0?" + ":"")+this.value+"%"}},plotLines:[{value:0,width:2,color:"silver"}]},plotOptions:{series:{compare:"percent",showInNavigator:!0}},tooltip:{pointFormat:'<span style="color:{series.color}">{series.name}</span>: <b>{point.y}</b> ({point.change}%)<br/>',valueDecimals:2,split:!0},series:seriesOptions})}function checkLastUpdate(date){var sameDate=!1,lastUpdated=new Date(date),now=new Date;return lastUpdated.getUTCDate()===now.getUTCDate()&&lastUpdated.getUTCMonth()===now.getUTCMonth()&&lastUpdated.getUTCFullYear()===now.getUTCFullYear()&&(sameDate=!0),sameDate}function generateStockUIElement(stockName,companyName,index){var highchartColors=Highcharts.getOptions().colors;console.log("color for "+stockName+": "+highchartColors[index]);var stock=document.createElement("div");stock.classList.add("stock"),stock.style.background=highchartColors[index],document.querySelector(".stocks").appendChild(stock);var ticker=document.createElement("div");ticker.classList.add("stock__ticker"),ticker.textContent=stockName,stock.appendChild(ticker);var company=document.createElement("div");company.classList.add("stock__company-name"),company.textContent=companyName,stock.appendChild(company);var remove=document.createElement("button");remove.textContent="X",stock.appendChild(remove),remove.addEventListener("click",function(e){socket.emit("remove ticker",{ticker:stockName}),e.target.parentNode.parentNode.removeChild(e.target.parentNode)})}var socket=io();jQuery.ajaxPrefilter(function(options){options.crossDomain&&jQuery.support.cors&&(options.url="https://cors-anywhere.herokuapp.com/"+options.url)}),window.onload=function(){socket.on("error message",function(data){data.display?document.querySelector(".error-message").classList.remove("visibility--hide"):document.querySelector(".error-message").classList.add("visibility--hide")}),socket.emit("request tickers",{}),socket.on("update processed",function(data){socket.emit("request tickers",{})}),document.querySelector(".submit-btn").addEventListener("click",function(e){e.preventDefault(),console.log(document.querySelector(".stock-ticker").value),document.querySelector(".stock-ticker").value&&socket.emit("add ticker",{ticker:document.querySelector(".stock-ticker").value.toUpperCase()})}),document.querySelector(".delete-btn").addEventListener("click",function(e){e.preventDefault(),document.querySelector(".delete-stock-ticker").value&&socket.emit("remove ticker",{ticker:document.querySelector(".delete-stock-ticker").value.toUpperCase()})}),socket.on("repaint",function(data){for(var stocksNode=document.querySelector(".stocks");stocksNode.firstChild;)stocksNode.removeChild(stocksNode.firstChild);console.log("Logging data: "+data.stockTickers);var seriesOptions=[],seriesCounter=0,names=data.stockTickers,to=new Date,from=new Date(to);from.setMonth(to.getMonth()-12);var urlFromSegment="&a="+from.getUTCMonth()+"&b="+from.getUTCDate()+"&c="+from.getUTCFullYear(),urlToSegment="&a="+to.getUTCMonth()+"&b="+to.getUTCDate()+"&c="+to.getUTCFullYear(),historicalURLs=names.map(function(stockTicker){return"http://real-chart.finance.yahoo.com/table.csv?s="+stockTicker+urlFromSegment+urlToSegment}),nameURLs=names.map(function(stockTicker){return"http://autoc.finance.yahoo.com/autoc?query="+stockTicker.toLowerCase()+"&region=1&lang=en"});names.forEach(function(name,index){if(sessionStorage.getItem(name)&&checkLastUpdate(JSON.parse(sessionStorage.getItem(name)).lastUpdated)){console.log("loading "+name+" from session storage");var sessionStoredStock=JSON.parse(sessionStorage.getItem(name));seriesOptions[index]={name:name,data:sessionStoredStock.data},seriesCounter+=1,console.log("generating UI for: "+sessionStoredStock.company),generateStockUIElement(name,sessionStoredStock.company,index),seriesCounter===names.length&&createChart(seriesOptions)}else{var companyName="",today=new Date,sessionData=void 0,days=void 0,promise1=$.get(nameURLs[index]).then(function(data){companyName=data.ResultSet.Result[0].name,console.log("generating UI from ajax for: "+companyName),console.log("data: "+data.ResultSet.Result[0].name),generateStockUIElement(name,companyName,index)}),promise2=$.get(historicalURLs[index],function(data){console.log("ajax request for: "+name),days=data.split(/\r\n|\n/).sort().map(function(row){var items=row.split(",");return[Date.parse(items[0]),parseFloat((+items[4]).toFixed(2))]}).filter(function(row,i){return row[0]&&0!==i})});Promise.all([promise1,promise2]).then(function(){sessionData={stock:name,company:companyName,data:days,lastUpdated:today},console.log("session data for: "+name+" "+companyName),console.log(sessionData),sessionStorage.setItem(name,JSON.stringify(sessionData)),seriesOptions[index]={name:name,data:days},(seriesCounter+=1)===names.length&&createChart(seriesOptions)})}})}),socket.on("load stock",function(data){})}},{}]},{},[1]);
//# sourceMappingURL=post.bundle.js.map
